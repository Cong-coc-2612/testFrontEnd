{"ast":null,"code":"import _regeneratorRuntime from\"E:\\\\frontEnd\\\\SportTournamentSupportSystemFE\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _objectSpread from\"E:\\\\frontEnd\\\\SportTournamentSupportSystemFE\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(doUpdateBackground),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(watchUpdateBackground);import axios from'axios';import{call,put,takeLatest}from'redux-saga/effects';import'whatwg-fetch';import{COMMON_SHOW_NOTIFICATION,USER_UPDATE_BACKGROUND}from'redux-saga/actions';import{QUERY_USER_INFO_SUCCESS}from'screens/UserInfo/reducers';import{LOGIN_SUCCESS}from'screens/Login/reducers';import store from'redux-saga/store';import config from'config';var uploadFile=function uploadFile(data,path,param){if(param.file!=null){var file=param.file[0];var form=new FormData();form.append('file',file);// return query(uri, METHOD.POST, undefined, undefined, paths, form);\nreturn new Promise(function(resolve,reject){axios.post(\"\".concat(config.apiUrl.baseURI,\"user/uploadBackground\"),form,{params:{id:param.id},headers:{'Content-Type':'multipart/form-data'}}).then(function(response){console.log('SUCCESS!!',response);resolve(response);}).catch(function(error){console.log('FAILED!!',error);reject(error);});});}else{return null;}};function doUpdateBackground(request){var response,data;return _regeneratorRuntime.wrap(function doUpdateBackground$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return call(uploadFile,request.data.data,request.data.path,request.data.param);case 3:response=_context.sent;data=response.data.result;if(!(response.data.error.MessageCode===0)){_context.next=15;break;}_context.next=8;return put({type:request.response.success,payload:data.User});case 8:_context.next=10;return put({type:QUERY_USER_INFO_SUCCESS,payload:_objectSpread({},store.getState().userInfo,{User:data.User})});case 10:if(!(store.getState().currentUserInfo!=null&&store.getState().currentUserInfo.id===data.User.id)){_context.next=13;break;}_context.next=13;return put({type:LOGIN_SUCCESS,payload:data.User});case 13:_context.next=16;break;case 15:throw new Error(response.data.error.Message);case 16:_context.next=22;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](0);_context.next=22;return put({type:COMMON_SHOW_NOTIFICATION,data:{type:'error',title:'Update Background',content:_context.t0,time:new Date()}});case 22:case\"end\":return _context.stop();}}},_marked,null,[[0,18]]);}export default function watchUpdateBackground(){return _regeneratorRuntime.wrap(function watchUpdateBackground$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return takeLatest(USER_UPDATE_BACKGROUND,doUpdateBackground);case 2:case\"end\":return _context2.stop();}}},_marked2);}","map":{"version":3,"sources":["E:/frontEnd/SportTournamentSupportSystemFE/src/redux-saga/sagas/UpdateBackground/updateBackground.ts"],"names":["doUpdateBackground","watchUpdateBackground","axios","call","put","takeLatest","COMMON_SHOW_NOTIFICATION","USER_UPDATE_BACKGROUND","QUERY_USER_INFO_SUCCESS","LOGIN_SUCCESS","store","config","uploadFile","data","path","param","file","form","FormData","append","Promise","resolve","reject","post","apiUrl","baseURI","params","id","headers","then","response","console","log","catch","error","request","result","MessageCode","type","success","payload","User","getState","userInfo","currentUserInfo","Error","Message","title","content","time","Date"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport { call, put, takeLatest } from 'redux-saga/effects';\r\nimport 'whatwg-fetch';\r\nimport { IParams, IRequest, IBigRequest, IResponse } from 'interfaces/common';\r\nimport { COMMON_SHOW_NOTIFICATION, USER_UPDATE_BACKGROUND } from 'redux-saga/actions';\r\nimport { QUERY_USER_INFO_SUCCESS } from 'screens/UserInfo/reducers';\r\nimport { LOGIN_SUCCESS } from 'screens/Login/reducers';\r\nimport store from 'redux-saga/store';\r\nimport config from 'config';\r\n\r\nconst uploadFile = (data: IParams, path: string | number, param: IParams) => {\r\n  if (param.file != null) {\r\n    const file: File = (param.file as unknown as IParams[])[0] as unknown as File;\r\n    const form = new FormData();\r\n    form.append('file', file);\r\n    // return query(uri, METHOD.POST, undefined, undefined, paths, form);\r\n    return new Promise<IResponse<IParams>>((resolve: Function, reject: Function) => {\r\n      axios.post(`${config.apiUrl.baseURI}user/uploadBackground`,\r\n        form,\r\n        {\r\n          params: { id: param.id },\r\n          headers: {\r\n            'Content-Type': 'multipart/form-data'\r\n          }\r\n        }\r\n      ).then((response) => {\r\n        console.log('SUCCESS!!', response);\r\n        resolve(response);\r\n      })\r\n        .catch((error) => {\r\n          console.log('FAILED!!', error);\r\n          reject(error);\r\n        });\r\n    });\r\n  } else {\r\n    return null;\r\n  }\r\n};\r\n\r\nfunction* doUpdateBackground(request: IRequest<IBigRequest>) {\r\n  try {\r\n    const response = yield call(uploadFile, request.data.data, request.data.path, request.data.param);\r\n    const data = response.data.result;\r\n    if (response.data.error.MessageCode === 0) {\r\n      yield put({\r\n        type: request.response.success,\r\n        payload: data.User,\r\n      });\r\n      yield put({\r\n        type: QUERY_USER_INFO_SUCCESS,\r\n        payload: { ...store.getState().userInfo, User: data.User },\r\n      });\r\n      if (store.getState().currentUserInfo != null && store.getState().currentUserInfo!.id === data.User.id) {\r\n        yield put({\r\n          type: LOGIN_SUCCESS,\r\n          payload: data.User,\r\n        });\r\n      }\r\n    } else {\r\n      throw new Error(response.data.error.Message);\r\n    }\r\n  } catch (error) {\r\n    yield put({\r\n      type: COMMON_SHOW_NOTIFICATION,\r\n      data: {\r\n        type: 'error',\r\n        title: 'Update Background',\r\n        content: error,\r\n        time: new Date(),\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport default function* watchUpdateBackground() {\r\n  yield takeLatest(USER_UPDATE_BACKGROUND, doUpdateBackground);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}